/**
* @name FriendInvites
* @description Simple friend-invites.
* @author ace.
* @version 1.2.0
* @source https://raw.githubusercontent.com/AceLikesGhosts/bd-plugins/master/dist/FriendInvites/FriendInvites.plugin.js
* @authorLink https://github.com/AceLikesGhosts/bd-plugins
* @authorId 327639826075484162
*/
(()=>{"use strict";var e={713:function(e,t){var i=this&&this.__classPrivateFieldGet||function(e,t,i,s){if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t==="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?s:i==="a"?s.call(e):s?s.value:t.get(e)};var s,n,r;Object.defineProperty(t,"__esModule",{value:true});class ApplicationCommandAPI{constructor(e,t,a){s.add(this);this.ApplicationCommandStore=e;this.UserStore=t;this.IconUtils=a;this.commands=new Map;i(this,s,"m",n).call(this);i(this,s,"m",r).call(this)}get CurrentUserSection(){const e=this.UserStore.getCurrentUser();return{id:e.id,name:e.username,type:1,icon:e.avatar}}register(e,t){t.applicationId="-1";t.id=`${this.CurrentUserSection.name}_${this.commands.size+1}`.toLowerCase();this.commands.set(e,t);this.ApplicationCommandStore.ZP.shouldResetAll=true}unregister(){this.commands.clear();this.ApplicationCommandStore.ZP.shouldResetAll=true}}s=new WeakSet,n=function _ApplicationCommandAPI_patchApplicationCommands(){const e=BdApi.Webpack.getModule((e=>e?.Kh?.toString?.()?.includes?.("BUILT_IN_TEXT")));BdApi.Patcher.after("FriendInvites",this.ApplicationCommandStore,"JK",((e,t,i)=>{if(!i||!this.commands.size)return;if(!Array.isArray(i.sectionDescriptors)||!i.sectionDescriptors.some((e=>e.id==this.CurrentUserSection.id)))i.sectionDescriptors=Array.isArray(i.sectionDescriptors)?i.sectionDescriptors.splice(1,0,this.CurrentUserSection):[this.CurrentUserSection];if(!Array.isArray(i.commands)||Array.from(this.commands.values()).some((e=>!i.commands.includes(e))))i.commands=Array.isArray(i.commands)?[...i.commands.filter((e=>!Array.from(this.commands.values()).includes(e))),...Array.from(this.commands.values())]:Array.from(this.commands.values());return i}));BdApi.Patcher.after("FriendInvites",this.ApplicationCommandStore.ZP,"getChannelState",((e,t,i)=>{if(!i||!this.commands.size)return;if(!Array.isArray(i.applicationSections)||!i.applicationSections.some((e=>e.id==this.CurrentUserSection.id)))i.applicationSections=Array.isArray(i.applicationSections)?[this.CurrentUserSection,...i.applicationSections]:[this.CurrentUserSection];if(!Array.isArray(i.applicationCommands)||Array.from(this.commands.values()).some((e=>!i.applicationCommands.includes(e))))return i}));BdApi.Patcher.after("FriendInvites",e,"Kh",((e,t,i)=>Array.isArray(i)?[...i.filter((e=>!Array.from(this.commands.values()).includes(e))),...Array.from(this.commands.values())]:Array.from(this.commands.values())))},r=function _ApplicationCommandAPI_patchIconUtils(){BdApi.Patcher.instead("FriendInvites",this.IconUtils,"getApplicationIconURL",((e,t,i)=>{if(t[0].id!==this.CurrentUserSection.id)return i(...t);return this.IconUtils.getUserAvatarURL(this.UserStore.getCurrentUser())}))};class default_1{constructor(){this.UserStore=BdApi.Webpack.getStore("UserStore");this.ApplicationCommandStore=BdApi.Webpack.getModule((e=>e?.ZP?.getApplicationSections));this.TimestampUtils=BdApi.Webpack.getByKeys("fromTimestamp");this.IconUtils=BdApi.Webpack.getByKeys("getApplicationIconUrl");this.DiscordConstants=BdApi.Webpack.getModule((e=>e?.Plq?.ADMINISTRATOR==8n));this.InstantInviteStore=BdApi.Webpack.getByKeys("createFriendInvite");this.MessageModule=BdApi.Webpack.getByKeys("sendBotMessage");this.CommandAPI=void 0}FakeMessage(e,t,i){return{id:this.TimestampUtils.fromTimestamp(Date.now()),type:this.DiscordConstants.uaV.DEFAULT,flags:this.DiscordConstants.iLy.EPHEMERAL,content:t,channel_id:e,author:this.UserStore.getCurrentUser(),attachments:[],embeds:i!==null?i:[],pinned:false,mentions:[],mention_channels:[],mention_roles:[],mention_everyone:false,timestamp:(new Date).toISOString(),state:this.DiscordConstants.yb.SENT,tts:false}}start(){console.log("%c[FriendInvites]","color: #ff00ee","Plugin enabled!");this.CommandAPI=new ApplicationCommandAPI(this.ApplicationCommandStore,this.UserStore,this.IconUtils);console.log("%c[FriendInvites]","color: #ff00ee","Patching XMLHttpRequest to prevent sending requests to Discord from client-side slash commands. (oop)");BdApi.Patcher.before("FriendInvites",XMLHttpRequest.prototype,"open",(e=>{if(e[0]==="GET"&&e[1].toLowerCase().includes("application-commands/search?type=1&query=invites")){return}}));const showErrorHappened=(e,t)=>{void this.MessageModule.receiveMessage(t,this.FakeMessage(t,"",[{type:"rich",title:"An unexpected error has occured",description:`\n                                Failed to preform that action...\n                                \`\`\`\n                                ${e}\n                                \`\`\`\n                                `}]))};this.CommandAPI.register("invites view",{name:"invites view",displayName:"invites view",name_localizations:void 0,description:"View your active friend invites",displayDescription:"View your active friend invites",description_localizations:void 0,type:1,options:[],execute:async(e,{channel:t})=>{try{this.InstantInviteStore.getAllFriendInvites().then((e=>{const i=e.map((e=>`\n                                **discord.gg/${e.code}**\n                                **Created:** <t:${Math.round(new Date(e.created_at).getTime()/1e3)}:R>\n                                **Expires:** <t:${new Date(e.expires_at).getTime()/1e3}:R> \n                                **Uses:** ${e.uses}/${e.max_uses}\n                                `));void this.MessageModule.receiveMessage(t.id,this.FakeMessage(t.id,"",[{type:"rich",title:`You have ${e.length<1?"no active friend invites!":`${e.length.toLocaleString()} active ${e.length>1?"invites":"invite"}`}`,description:e.length>=1?i.join("\n"):"N/A"}]))})).catch((e=>showErrorHappened(e,t.id)))}catch(e){showErrorHappened(e,t.id);console.error(e)}}});this.CommandAPI.register("invites create",{name:"invites create",displayName:"invites create",name_localizations:void 0,description:"Create a new friend invite",displayDescription:"Create a new friend invite",description_localizations:void 0,type:1,options:[],execute:async(e,{channel:t})=>{if(!this.UserStore.getCurrentUser().phone){void this.MessageModule.receiveMessage(t.id,this.FakeMessage(t.id,"",[{type:"rich",title:"Creating friend invites requires having a mobile phone number connected to your account.",content:""}]));return}try{this.InstantInviteStore.createFriendInvite().then((e=>{void this.MessageModule.receiveMessage(t.id,this.FakeMessage(t.id,"",[{type:"rich",title:"Created friend code ("+e.code+")",description:`\n                                            [Created new friend code! (${e.code})](https://discord.gg/${e.code})\n                                            **discord.gg/${e.code}**\n                                            **Max Uses:** ${e.max_uses}\n                                            **Expires:** <t:${new Date(e.expires_at).getTime()/1e3}:R> \n                                            `}]))})).catch((e=>showErrorHappened(e,t.id)))}catch(e){showErrorHappened(e,t.id);console.error(e)}}});this.CommandAPI.register("invites delete",{name:"invites delete",displayName:"invites delete",name_localizations:void 0,description:"Delete all active friend invites",displayDescription:"Delete all active friend invites",description_localizations:void 0,type:1,options:[],execute:async(e,{channel:t})=>{try{this.InstantInviteStore.revokeFriendInvites().then((()=>{void this.MessageModule.receiveMessage(t.id,this.FakeMessage(t.id,"",[{type:"rich",title:"Deleted all invite codes",description:"Little sad we can't delete individual ones :c"}]))})).catch((e=>showErrorHappened(e,t.id)))}catch(e){showErrorHappened(e,t.id);console.error(e)}}})}stop(){this.CommandAPI?.unregister();BdApi.Patcher.unpatchAll("FriendInvites")}}t["default"]=default_1}};if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var t={};e[713](0,t);module.exports=t})();